import { Callout } from 'nextra/components'
import { Tabs } from 'nextra/components'

# ç‚¼åŒ–å·¥å‚å®æ—¶ç”Ÿäº§æ•°æ®

è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿç‚¼åŒ–å·¥å‚å®æ—¶ç”Ÿäº§æ•°æ®çš„å¯è§†åŒ–å±•ç¤ºç¤ºä¾‹ã€‚è¯¥ç¤ºä¾‹å±•ç¤ºäº†ç‚¼åŒ–å·¥å‚çš„å„ä¸ªç¯èŠ‚çš„å®æ—¶æ•°æ®ç»Ÿè®¡ï¼ŒåŒ…å«ä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š

- ğŸ›¢ï¸ ç®¡é“è¾“å‡ºé‡
- ğŸš‚ é“è·¯è¿è¾“é‡
- ğŸš› å…¬è·¯è¿è¾“é‡
- ğŸš¢ æ°´è·¯è¿è¾“é‡
- ğŸ“Š æ€»å¤„ç†é‡
- ğŸ­ 1å·çº¿è·¯è¾“é€é‡
- ğŸ­ 2å·çº¿è·¯è¾“é€é‡

ç³»ç»Ÿæ¯ 100ms ä¼šæ›´æ–°ä¸€æ¬¡æ•°æ®ï¼Œæ¨¡æ‹Ÿå®æ—¶ç”Ÿäº§è¿‡ç¨‹ä¸­ä¸åŒè·¯çº¿çš„è¾“å…¥é‡å’Œå„ä¸ªè¿è¾“æ–¹å¼çš„è¾“å‡ºé‡å˜åŒ–ã€‚æ•°æ®ç‰¹ç‚¹ï¼š

<Callout type="info">
ç¤ºä¾‹ä¸­çš„åŠ¨ç”»æ•ˆæœé‡‡ç”¨äº† `LoopFlow` ç±»å‹ï¼Œé€šè¿‡æµåŠ¨çº¿æ¡ç›´è§‚å±•ç¤ºäº†äº§å“åœ¨å„ä¸ªè¾“é€ç®¡é“ä¸­çš„æµåŠ¨è¿‡ç¨‹ã€‚
</Callout>

## æ¼”ç¤ºæ•ˆæœ

import { Wrap, RefineryDemo } from "../../../demos";

<Wrap>
  <RefineryDemo />
</Wrap>

## ç¤ºä¾‹ä»£ç 

<Tabs items={['index.tsx','utils.ts','types.ts']}>
  <Tabs.Tab>
```tsx copy filename=index.tsx
import { AnimationType, ICraftPlayer, ICraftPlayerInstance } from "@icraft/player-react";
import { useEffect, useRef } from "react";
import { getData } from "./utils";
import { INITIAL_METRICS, LINE_NAMES, RefineryMetricKey } from "./types";

const METRIC_NAMES = Object.keys(INITIAL_METRICS) as RefineryMetricKey[];

const style = {
  width: "100%",
  height: "100%",
  position: "relative" as const,
  overflow: "hidden" as const,
};

export default () => {
  const playerRef = useRef<ICraftPlayerInstance>(null);
  const timerRef = useRef<NodeJS.Timeout>();

  const updateData = async () => {
    const player = playerRef.current;
    if (!player) return;
    const data = await getData();
    METRIC_NAMES.forEach((name) => {
      const element = player.getElementsByName(name)?.[0];
      if (element && element.typeName === "text") {
        element.updateAttribute({
          type: "text",
          value: data[name].toString(),
        });
      }
    });
  };

  useEffect(() => {
    updateData();
    timerRef.current = setInterval(updateData, 100);
    return () => {
      if (timerRef.current) {
        clearInterval(timerRef.current);
      }
    };
  }, []);

  const onReady = (instance: ICraftPlayerInstance) => {
    const player = instance;
    LINE_NAMES.forEach((name) => {
      const element = player.getElementsByName(name)?.[0];
      if (element && element.typeName === "line") {
        player.playAnimationByElementKey(element.key, {
          animationType: AnimationType.LoopFlow,
          flowLineColor: "#ffff00",
          flowLineSize: 0.04,
        });
      }
    });
  };

  return (
    <div style={style}>
      <ICraftPlayer
        src='/templates/RefineryStatistics.iplayer'
        ref={playerRef}
        defaultCustomCamera={4}
        onReady={onReady}
      />
    </div>
  );
};
```
  </Tabs.Tab>

  <Tabs.Tab>
```ts copy filename=utils.ts
import { INITIAL_METRICS, RefineryMetrics, RefineryMetricKey } from './types';

let baseValues: RefineryMetrics = { ...INITIAL_METRICS };

const getRandomIncrement = (min: number, max: number) => {
  return Math.floor(Math.random() * (max - min + 1)) + min;
};

export const getData = async () => {
  (Object.keys(baseValues) as RefineryMetricKey[]).forEach((key) => {
    if (key !== 'TotalProcessingNum') {
      baseValues[key] += getRandomIncrement(1, 5);
    }
  });
  baseValues.TotalProcessingNum = 
    baseValues.PipelineOutputNum + 
    baseValues.RailwayOutputNum + 
    baseValues.HighwayOutputNum + 
    baseValues.WaterwayOutputNum;
    
  return baseValues;
};
```
  </Tabs.Tab>

  <Tabs.Tab>
```ts copy filename=types.ts
export type RefineryMetrics = {
  PipelineOutputNum: number;
  RailwayOutputNum: number;
  HighwayOutputNum: number;
  WaterwayOutputNum: number;
  TotalProcessingNum: number;
  "Volume1#": number;
  "Volume2#": number;
};

export const INITIAL_METRICS: RefineryMetrics = {
  PipelineOutputNum: 1000,
  RailwayOutputNum: 800,
  HighwayOutputNum: 600,
  WaterwayOutputNum: 400,
  TotalProcessingNum: 2800,
  "Volume1#": 1500,
  "Volume2#": 1200,
};

export type RefineryMetricKey = keyof RefineryMetrics;

export const LINE_NAMES = ['Line1', 'Line2', 'Line3', 'Line4', 'Line5', 'Line6', 'Line7', 'Line8', 'Line9', 'Line10', 'Line11'] as const;
```
  </Tabs.Tab>

</Tabs>
